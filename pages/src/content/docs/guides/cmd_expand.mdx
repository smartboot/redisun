---
title: Commandå¼€å‘æŒ‡å—
description: Redisun æ˜¯ä¸€ä¸ªåŸºäº smart-socket å¼€å‘çš„è½»é‡çº§é«˜æ€§èƒ½ Redis å®¢æˆ·ç«¯ï¼Œä¸“ä¸º Java å¹³å°è®¾è®¡ã€‚
sidebar:
  order: 2
---

# Rediså‘½ä»¤æ‰©å±•å¼€å‘æŒ‡å— ğŸš€

æ¬¢è¿æ¥åˆ° Redisun ç¤¾åŒºï¼æœ¬æŒ‡å—å°†å¸®åŠ©ä½ äº†è§£å¦‚ä½•ä¸º Redisun å®¢æˆ·ç«¯è´¡çŒ®æ–°çš„ Redis å‘½ä»¤å®ç°ã€‚Redisun æ˜¯ä¸€ä¸ªè½»é‡çº§ã€é«˜æ€§èƒ½çš„ Redis å®¢æˆ·ç«¯ï¼Œä¸“ä¸º Java å¹³å°è®¾è®¡ã€‚æˆ‘ä»¬çƒ­å¿±æ¬¢è¿ç¤¾åŒºå¼€å‘è€…å‚ä¸è´¡çŒ®ï¼Œä¸€èµ·å®Œå–„ Redisun çš„å‘½ä»¤æ”¯æŒã€‚

## é¡¹ç›®æ¶æ„æ¦‚è§ˆ ğŸ—ï¸

åœ¨å¼€å§‹å¼€å‘ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ Redisun çš„æ ¸å¿ƒæ¶æ„ï¼š

```
src/main/java/tech/smartboot/redisun/
â”œâ”€â”€ Command.java              # å‘½ä»¤æŠ½è±¡åŸºç±»
â”œâ”€â”€ Redisun.java              # å®¢æˆ·ç«¯ä¸»ç±»
â”œâ”€â”€ RedisunOptions.java       # å®¢æˆ·ç«¯é…ç½®é€‰é¡¹
â”œâ”€â”€ cmd/                      # å…·ä½“å‘½ä»¤å®ç°ç›®å½•
â”‚   â”œâ”€â”€ SetCommand.java       # SET å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ GetCommand.java       # GET å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ DelCommand.java       # DEL å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ IncrCommand.java      # INCR å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ DecrCommand.java      # DECR å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ StrlenCommand.java    # STRLEN å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ AppendCommand.java    # APPEND å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ HSetCommand.java      # HSET å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ HGetCommand.java      # HGET å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ SAddCommand.java      # SADD å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ ZAddCommand.java      # ZADD å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ ZRemCommand.java      # ZREM å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ ZRangeCommand.java    # ZRANGE å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ ZScoreCommand.java    # ZSCORE å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ ExistsCommand.java    # EXISTS å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ DBSizeCommand.java    # DBSIZE å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ FlushAllCommand.java  # FLUSHALL å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ FlushDbCommand.java   # FLUSHDB å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ SelectCommand.java    # SELECT å‘½ä»¤å®ç°
â”‚   â””â”€â”€ ...                   # å…¶ä»–å‘½ä»¤å®ç°
â””â”€â”€ resp/                     # RESP åè®®è§£ææ¨¡å—
    â”œâ”€â”€ RESP.java             # RESP åè®®åŸºç±»
    â”œâ”€â”€ BulkStrings.java      # æ‰¹é‡å­—ç¬¦ä¸²ç±»å‹
    â”œâ”€â”€ SimpleStrings.java    # ç®€å•å­—ç¬¦ä¸²ç±»å‹
    â””â”€â”€ ...                   # å…¶ä»– RESP ç±»å‹
```

## å‘½ä»¤å®ç°åŸºç¡€ ğŸ¯

### Command æŠ½è±¡åŸºç±»

æ‰€æœ‰ Redis å‘½ä»¤å®ç°éƒ½å¿…é¡»ç»§æ‰¿ [Command](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/Command.java) æŠ½è±¡åŸºç±»ã€‚è¯¥ç±»å®šä¹‰äº†å‘½ä»¤æ„å»ºçš„é€šç”¨æ¥å£ï¼š

```java
public abstract class Command {
    protected abstract List<BulkStrings> buildParams();
}
```

æ¯ä¸ªå…·ä½“çš„å‘½ä»¤å®ç°ç±»éƒ½éœ€è¦å®ç° [buildParams()](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/Command.java#L29) æ–¹æ³•ï¼Œç”¨äºæ„å»ºç¬¦åˆ Redis åè®®è§„èŒƒçš„å‘½ä»¤å‚æ•°åˆ—è¡¨ã€‚

### ç¤ºä¾‹ï¼šSET å‘½ä»¤å®ç°

è®©æˆ‘ä»¬ä»¥ [SetCommand](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/cmd/SetCommand.java) ä¸ºä¾‹ï¼Œäº†è§£å¦‚ä½•å®ç°ä¸€ä¸ª Redis å‘½ä»¤ï¼š

```java
public class SetCommand extends Command {
    private static final BulkStrings CONSTANTS_SET = BulkStrings.of("SET");
    private final String key;
    private final String value;
    
    public SetCommand(String key, String value) {
        this.key = key;
        this.value = value;
    }
    
    @Override
    protected List<BulkStrings> buildParams() {
        List<BulkStrings> param = new ArrayList<>();
        // æ·»åŠ å‘½ä»¤åç§°
        param.add(CONSTANTS_SET);
        // æ·»åŠ é”®
        param.add(RESP.ofString(key));
        // æ·»åŠ å€¼
        param.add(RESP.ofString(value));
        return param;
    }
}
```

## å¼€å‘æ–°å‘½ä»¤çš„æ­¥éª¤ ğŸ› ï¸

### 1. åˆ›å»ºå‘½ä»¤ç±»

åœ¨ [cmd](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/cmd) ç›®å½•ä¸‹åˆ›å»ºæ–°çš„å‘½ä»¤ç±»ï¼Œä¾‹å¦‚å®ç° `INCR` å‘½ä»¤ï¼š

```java
package tech.smartboot.redisun.cmd;

import tech.smartboot.redisun.Command;
import tech.smartboot.redisun.resp.BulkStrings;
import tech.smartboot.redisun.resp.RESP;

import java.util.ArrayList;
import java.util.List;

/**
 * Redis INCRBY å‘½ä»¤å®ç°ç±»
 * <p>
 * å°† key æ‰€å‚¨å­˜çš„å€¼åŠ ä¸Šç»™å®šçš„å¢é‡å€¼ï¼ˆincrementï¼‰ã€‚
 * å¦‚æœ key ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆ key çš„å€¼ä¼šå…ˆè¢«åˆå§‹åŒ–ä¸º 0 ï¼Œç„¶åå†æ‰§è¡Œ INCRBY æ“ä½œã€‚
 * å¦‚æœå€¼åŒ…å«é”™è¯¯çš„ç±»å‹ï¼Œæˆ–å­—ç¬¦ä¸²ç±»å‹çš„å€¼ä¸èƒ½è¡¨ç¤ºä¸ºæ•°å­—ï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚
 * æœ¬æ“ä½œçš„å€¼é™åˆ¶åœ¨ 64 ä½(bit)æœ‰ç¬¦å·æ•°å­—è¡¨ç¤ºä¹‹å†…ã€‚
 * </p>
 * 
 * @see <a href="https://redis.io/commands/incrby/">Redis INCRBY Command</a>
 */
public class IncrByCommand extends Command {
    private static final BulkStrings CONSTANTS_INCRBY = BulkStrings.of("INCRBY");
    private final String key;
    private final long increment;

    public IncrByCommand(String key, long increment) {
        this.key = key;
        this.increment = increment;
    }
    
    @Override
    protected List<BulkStrings> buildParams() {
        List<BulkStrings> param = new ArrayList<>();
        param.add(CONSTANTS_INCRBY);
        param.add(RESP.ofString(key));
        param.add(RESP.ofString(String.valueOf(increment)));
        return param;
    }
}
```

```java
package tech.smartboot.redisun.cmd;

import tech.smartboot.redisun.Command;
import tech.smartboot.redisun.resp.BulkStrings;
import tech.smartboot.redisun.resp.RESP;

import java.util.ArrayList;
import java.util.List;

/**
 * Redis INCR å‘½ä»¤å®ç°ç±»
 * <p>
 * å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€ã€‚
 * å¦‚æœ key ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆ key çš„å€¼ä¼šå…ˆè¢«åˆå§‹åŒ–ä¸º 0 ï¼Œç„¶åå†æ‰§è¡Œ INCR æ“ä½œã€‚
 * </p>
 * 
 * @see <a href="https://redis.io/commands/incr/">Redis INCR Command</a>
 */
public class IncrCommand extends Command {
    private static final BulkStrings CONSTANTS_INCR = BulkStrings.of("INCR");
    private final String key;

    public IncrCommand(String key) {
        this.key = key;
    }

    @Override
    protected List<BulkStrings> buildParams() {
        List<BulkStrings> param = new ArrayList<>();
        param.add(CONSTANTS_INCR);
        param.add(RESP.ofString(key));
        return param;
    }
}
```

### 2. åœ¨å®¢æˆ·ç«¯ä¸­æ·»åŠ æ–¹æ³•

åœ¨ [Redisun.java](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/Redisun.java) ä¸­æ·»åŠ å¯¹åº”çš„æ–¹æ³•ï¼š

```java
/**
 * å°† key æ‰€å‚¨å­˜çš„å€¼åŠ ä¸Šç»™å®šçš„å¢é‡å€¼ï¼ˆincrementï¼‰
 *
 * @param key       è¦å¢åŠ çš„é”®
 * @param increment å¢é‡å€¼
 * @return æ‰§è¡Œå‘½ä»¤å key çš„å€¼
 */
public long incrBy(String key, long increment) {
    RESP r = syncExecute(new IncrByCommand(key, increment));
    if (r instanceof Integers) {
        return ((Integers) r).getValue();
    }
    throw new RedisunException("invalid response:" + r);
}
```

å¯¹äºä¸€äº›å¸¸ç”¨çš„æ ¸å¿ƒæŒ‡ä»¤ï¼Œè¿˜éœ€è¦åŒæ—¶æä¾›å¼‚æ­¥æ¥å£ä»¥æ»¡è¶³é«˜å¹¶å‘åœºæ™¯çš„éœ€æ±‚ï¼š

```
/**
 * å°† key æ‰€å‚¨å­˜çš„å€¼åŠ ä¸Šç»™å®šçš„å¢é‡å€¼ï¼ˆincrementï¼‰ï¼ˆå¼‚æ­¥ç‰ˆæœ¬ï¼‰
 *
 * @param key       è¦å¢åŠ çš„é”®
 * @param increment å¢é‡å€¼
 * @return æ‰§è¡Œå‘½ä»¤å key çš„å€¼
 */
public CompletableFuture<Long> asyncIncrBy(String key, long increment) {
    return execute(new IncrByCommand(key, increment)).thenApply(resp -> {
        if (resp instanceof Integers) {
            return ((Integers) resp).getValue();
        }
        throw new RedisunException("invalid response:" + resp);
    });
}
```

### åˆ—è¡¨å‘½ä»¤å®¢æˆ·ç«¯æ–¹æ³•ç¤ºä¾‹

åˆ—è¡¨å‘½ä»¤é€šå¸¸éœ€è¦å¤„ç†ä¸åŒçš„è¿”å›ç±»å‹ã€‚ä¾‹å¦‚ï¼Œæ’å…¥å‘½ä»¤è¿”å›åˆ—è¡¨é•¿åº¦ï¼ˆæ•´æ•°ï¼‰ï¼Œè€Œå¼¹å‡ºå‘½ä»¤è¿”å›å…ƒç´ å€¼ï¼ˆå­—ç¬¦ä¸²ï¼‰æˆ–nullï¼š

```java
/**
 * å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨çš„å¤´éƒ¨(å·¦è¾¹)
 *
 * @param key    åˆ—è¡¨çš„é”®
 * @param values è¦æ’å…¥çš„ä¸€ä¸ªæˆ–å¤šä¸ªå€¼
 * @return æ‰§è¡Œååˆ—è¡¨çš„é•¿åº¦
 */
public long lpush(String key, String... values) {
    RESP r = syncExecute(new LPushCommand(key, values));
    if (r instanceof Integers) {
        return ((Integers) r).getValue();
    }
    throw new RedisunException("invalid response:" + r);
}
```

```java
/**
 * ç§»é™¤å¹¶è¿”å›åˆ—è¡¨çš„å¤´éƒ¨(å·¦è¾¹)ç¬¬ä¸€ä¸ªå…ƒç´ 
 *
 * @param key åˆ—è¡¨çš„é”®
 * @return åˆ—è¡¨çš„å¤´éƒ¨å…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™è¿”å›null
 */
public String lpop(String key) {
    RESP r = syncExecute(new LPopCommand(key));
    if (r instanceof Nulls) {
        return null;
    } else if (r instanceof BulkStrings) {
        return ((BulkStrings) r).getValue();
    }
    throw new RedisunException("invalid response:" + r);
}
```

å¯¹äºä¸€äº›å¸¸ç”¨çš„æ ¸å¿ƒæŒ‡ä»¤ï¼Œè¿˜éœ€è¦åŒæ—¶æä¾›å¼‚æ­¥æ¥å£ä»¥æ»¡è¶³é«˜å¹¶å‘åœºæ™¯çš„éœ€æ±‚ï¼š

```java
/**
 * å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨çš„å¤´éƒ¨(å·¦è¾¹)ï¼ˆå¼‚æ­¥ç‰ˆæœ¬ï¼‰
 *
 * @param key    åˆ—è¡¨çš„é”®
 * @param values è¦æ’å…¥çš„ä¸€ä¸ªæˆ–å¤šä¸ªå€¼
 * @return æ‰§è¡Œååˆ—è¡¨çš„é•¿åº¦
 */
public CompletableFuture<Long> asyncLpush(String key, String... values) {
    return execute(new LPushCommand(key, values)).thenApply(resp -> {
        if (resp instanceof Integers) {
            return ((Integers) resp).getValue().longValue();
        }
        throw new RedisunException("invalid response:" + resp);
    });
}
```

```java
/**
 * ç§»é™¤å¹¶è¿”å›åˆ—è¡¨çš„å¤´éƒ¨(å·¦è¾¹)ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå¼‚æ­¥ç‰ˆæœ¬ï¼‰
 *
 * @param key åˆ—è¡¨çš„é”®
 * @return åˆ—è¡¨çš„å¤´éƒ¨å…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™è¿”å›null
 */
public CompletableFuture<String> asyncLpop(String key) {
    return execute(new LPopCommand(key)).thenApply(resp -> {
        if (resp instanceof Nulls) {
            return null;
        } else if (resp instanceof BulkStrings) {
            return ((BulkStrings) resp).getValue();
        }
        throw new RedisunException("invalid response:" + resp);
    });
}
```

```java
/**
 * å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€
 *
 * @param key è¦å¢åŠ çš„é”®
 * @return æ‰§è¡Œå‘½ä»¤å key çš„å€¼
 */
public long incr(String key) {
    RESP r = syncExecute(new IncrCommand(key));
    if (r instanceof Integers) {
        return ((Integers) r).getValue();
    }
    throw new RedisunException("invalid response:" + r);
}
```

å¯¹äºä¸€äº›å¸¸ç”¨çš„æ ¸å¿ƒæŒ‡ä»¤ï¼Œè¿˜éœ€è¦åŒæ—¶æä¾›å¼‚æ­¥æ¥å£ä»¥æ»¡è¶³é«˜å¹¶å‘åœºæ™¯çš„éœ€æ±‚ï¼š

```
/**
 * å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€ï¼ˆå¼‚æ­¥ç‰ˆæœ¬ï¼‰
 *
 * @param key è¦å¢åŠ çš„é”®
 * @return æ‰§è¡Œå‘½ä»¤å key çš„å€¼
 */
public CompletableFuture<Long> asyncIncr(String key) {
    return execute(new IncrCommand(key)).thenApply(resp -> {
        if (resp instanceof Integers) {
            return ((Integers) resp).getValue();
        }
        throw new RedisunException("invalid response:" + resp);
    });
}
```

åŒæ­¥å’Œå¼‚æ­¥æ¥å£çš„è®¾è®¡åŸåˆ™ï¼š

1. åŒæ­¥æ–¹æ³•åéµå¾ª `command` æ ¼å¼ï¼Œå¦‚ [set](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/Redisun.java#L121-L124)ã€[get](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/Redisun.java#L96-L104)ã€[del](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/Redisun.java#L172-L174)
2. å¼‚æ­¥æ–¹æ³•åéµå¾ª `asyncCommand` æ ¼å¼ï¼Œå¦‚ [asyncSet](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/Redisun.java#L142-L144)ã€[asyncGet](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/Redisun.java#L-L)ã€[asyncDel](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/Redisun.java#L-L)
3. åŒæ­¥æ–¹æ³•å†…éƒ¨é€šè¿‡è°ƒç”¨ [syncExecute](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/Redisun.java#L187-L197) æ–¹æ³•æ‰§è¡Œå‘½ä»¤å¹¶é˜»å¡ç­‰å¾…ç»“æœ
4. å¼‚æ­¥æ–¹æ³•é€šè¿‡è°ƒç”¨ [execute](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/Redisun.java#L205-L239) æ–¹æ³•è¿”å› [CompletableFuture](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/Redisun.java#L23-L23) å¯¹è±¡ï¼Œå…è®¸éé˜»å¡æ“ä½œ

### 3. ç¼–å†™æµ‹è¯•ç”¨ä¾‹

åœ¨æµ‹è¯•æ–‡ä»¶ä¸­æ·»åŠ æ–°å‘½ä»¤çš„æµ‹è¯•ç”¨ä¾‹ï¼š

```java
@Test
public void testIncr() {
    String key = "test_incr_key";
    // å…ˆåˆ é™¤å¯èƒ½å­˜åœ¨çš„é”®
    redisun.del(key);
    // é¦–æ¬¡è°ƒç”¨åº”è¯¥è¿”å›1
    Assert.assertEquals(1, redisun.incr(key));
    // å†æ¬¡è°ƒç”¨åº”è¯¥è¿”å›2
    Assert.assertEquals(2, redisun.incr(key));
    // éªŒè¯GETå‘½ä»¤èƒ½æ­£ç¡®è·å–å€¼
    Assert.assertEquals("2", redisun.get(key));
}
```

## å‘½ä»¤å®ç°æœ€ä½³å®è·µ âœ…

### 1. å¸¸é‡ä¼˜åŒ–

å¯¹äºå‘½ä»¤ä¸­ä½¿ç”¨çš„å›ºå®šå­—ç¬¦ä¸²ï¼Œå»ºè®®å®šä¹‰ä¸ºé™æ€å¸¸é‡ä»¥æé«˜æ€§èƒ½ï¼š

```java
private static final BulkStrings CONSTANTS_SET = BulkStrings.of("SET");
private static final BulkStrings CONSTANTS_NX = BulkStrings.of("NX");
```

### 2. å‚æ•°å¤„ç†

ä½¿ç”¨ RESP å·¥å…·ç±»å¤„ç†å‚æ•°è½¬æ¢ï¼š

```java
param.add(RESP.ofString(key));
param.add(RESP.ofString(value));
```

### 3. å“åº”å¤„ç†

æ ¹æ® Redis å‘½ä»¤çš„å“åº”ç±»å‹è¿›è¡Œé€‚å½“å¤„ç†ï¼š

```java
// å¤„ç†æ•´æ•°å“åº”
if (r instanceof Integers) {
    return ((Integers) r).getValue();
}

// å¤„ç†å­—ç¬¦ä¸²å“åº”
if (r instanceof SimpleStrings) {
    return SimpleStrings.OK.equals(((SimpleStrings) r).getValue());
}

// å¤„ç†ç©ºå€¼å“åº”
if (r instanceof Nulls) {
    return null;
}
```

## å¤æ‚å‘½ä»¤ç¤ºä¾‹ ğŸ’¡

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„å‘½ä»¤ç¤ºä¾‹ - [SetCommand](https://gitee.com/smartboot/redisun/blob/master/src/main/java/tech/smartboot/redisun/cmd/SetCommand.java)ï¼Œå®ƒæ”¯æŒå¤šç§é€‰é¡¹ï¼š

```java
public class SetCommand extends Command {
    // å¸¸é‡å®šä¹‰
    private static final BulkStrings CONSTANTS_SET = BulkStrings.of("SET");
    private static final BulkStrings CONSTANTS_NX = BulkStrings.of("NX");
    private static final BulkStrings CONSTANTS_XX = BulkStrings.of("XX");
    
    private final String key;
    private final String value;
    private BulkStrings exists; // NX/XX é€‰é¡¹
    
    // è¿‡æœŸæ—¶é—´é€‰é¡¹å¤„ç†å™¨
    private Consumer<List<BulkStrings>> expire;
    
    public SetCommand(String key, String value) {
        this.key = key;
        this.value = value;
    }
    
    @Override
    protected List<BulkStrings> buildParams() {
        List<BulkStrings> param = new ArrayList<>();
        param.add(CONSTANTS_SET);
        param.add(RESP.ofString(key));
        param.add(RESP.ofString(value));
        
        // æ·»åŠ  NX/XX é€‰é¡¹
        if (exists != null) {
            param.add(exists);
        }
        
        // æ·»åŠ è¿‡æœŸæ—¶é—´é€‰é¡¹
        if (expire != null) {
            expire.accept(param);
        }
        return param;
    }
    
    // è®¾ç½® NX é€‰é¡¹
    public SetCommand setIfNotExists() {
        exists = CONSTANTS_NX;
        return this;
    }
    
    // è®¾ç½® XX é€‰é¡¹
    public SetCommand setIfExists() {
        exists = CONSTANTS_XX;
        return this;
    }
}
```

### åˆ—è¡¨å‘½ä»¤ç¤ºä¾‹

åˆ—è¡¨å‘½ä»¤é€šå¸¸ç”¨äºå¤„ç†Redisä¸­çš„åˆ—è¡¨æ•°æ®ç»“æ„ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›åˆ—è¡¨å‘½ä»¤çš„å®ç°ç¤ºä¾‹ï¼š

```java
public class LPushCommand extends Command {
    private static final BulkStrings CONSTANTS_LPUSH = BulkStrings.of("LPUSH");
    private final String key;
    private final String[] values;

    public LPushCommand(String key, String... values) {
        this.key = key;
        this.values = values;
    }

    @Override
    protected List<BulkStrings> buildParams() {
        List<BulkStrings> param = new ArrayList<>();
        param.add(CONSTANTS_LPUSH);
        param.add(RESP.ofString(key));
        for (String value : values) {
            param.add(RESP.ofString(value));
        }
        return param;
    }
}
```

```java
public class LPopCommand extends Command {
    private static final BulkStrings CONSTANTS_LPOP = BulkStrings.of("LPOP");
    private final String key;

    public LPopCommand(String key) {
        this.key = key;
    }

    @Override
    protected List<BulkStrings> buildParams() {
        List<BulkStrings> param = new ArrayList<>();
        param.add(CONSTANTS_LPOP);
        param.add(RESP.ofString(key));
        return param;
    }
}
```

### æœ‰åºé›†åˆå‘½ä»¤ç¤ºä¾‹

æœ‰åºé›†åˆå‘½ä»¤ç”¨äºå¤„ç†Redisä¸­çš„æœ‰åºé›†åˆæ•°æ®ç»“æ„ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰åºé›†åˆå‘½ä»¤çš„å®ç°ç¤ºä¾‹ï¼š

```java
public class ZRemCommand extends Command {
    private static final BulkStrings CONSTANTS_ZREM = BulkStrings.of("ZREM");
    private final String key;
    private final String[] members;

    public ZRemCommand(String key, String... members) {
        this.key = key;
        this.members = members;
    }

    @Override
    protected List<BulkStrings> buildParams() {
        List<BulkStrings> param = new ArrayList<>(2 + members.length);
        param.add(CONSTANTS_ZREM);
        param.add(RESP.ofString(key));
        for (String member : members) {
            param.add(RESP.ofString(member));
        }
        return param;
    }
}
```

```java
public class ZRangeCommand extends Command {
    private static final BulkStrings CONSTANTS_ZRANGE = BulkStrings.of("ZRANGE");
    private static final BulkStrings CONSTANTS_BYSCORE = BulkStrings.of("BYSCORE");
    private static final BulkStrings CONSTANTS_BYLEX = BulkStrings.of("BYLEX");
    private static final BulkStrings CONSTANTS_REV = BulkStrings.of("REV");
    private static final BulkStrings CONSTANTS_WITHSCORES = BulkStrings.of("WITHSCORES");
    private static final BulkStrings CONSTANTS_LIMIT = BulkStrings.of("LIMIT");
    
    private final String key;
    private final String start;
    private final String stop;
    
    // å››ä¸ªé€‰é¡¹å‚æ•°
    private boolean byScore = false;
    private boolean byLex = false;
    private boolean rev = false;
    private boolean withScores = false;
    
    // LIMITå‚æ•°
    private boolean hasLimit = false;
    private long limitOffset;
    private long limitCount;

    public ZRangeCommand(String key, String start, String stop) {
        this.key = key;
        this.start = start;
        this.stop = stop;
    }

    @Override
    protected List<BulkStrings> buildParams() {
        List<BulkStrings> param = new ArrayList<>(10);
        param.add(CONSTANTS_ZRANGE);
        param.add(RESP.ofString(key));
        param.add(RESP.ofString(start));
        param.add(RESP.ofString(stop));
        
        // æ·»åŠ é€‰é¡¹å‚æ•°
        if (byScore) {
            param.add(CONSTANTS_BYSCORE);
        }
        
        if (byLex) {
            param.add(CONSTANTS_BYLEX);
        }
        
        if (rev) {
            param.add(CONSTANTS_REV);
        }
        
        // æ·»åŠ LIMITå‚æ•°
        if (hasLimit) {
            param.add(CONSTANTS_LIMIT);
            param.add(RESP.ofString(String.valueOf(limitOffset)));
            param.add(RESP.ofString(String.valueOf(limitCount)));
        }
        
        if (withScores) {
            param.add(CONSTANTS_WITHSCORES);
        }
        
        return param;
    }
    
    /**
     * è®¾ç½® BYSCORE é€‰é¡¹ï¼šæŒ‰åˆ†æ•°æŸ¥è¯¢
     * 
     * @return å½“å‰ ZRangeCommand å®ä¾‹ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨
     */
    public ZRangeCommand byScore() {
        this.byScore = true;
        return this;
    }
    
    /**
     * è®¾ç½® BYLEX é€‰é¡¹ï¼šæŒ‰å­—å…¸åºæŸ¥è¯¢
     * 
     * @return å½“å‰ ZRangeCommand å®ä¾‹ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨
     */
    public ZRangeCommand byLex() {
        this.byLex = true;
        return this;
    }
    
    /**
     * è®¾ç½® REV é€‰é¡¹ï¼šå€’åºæ’åˆ—
     * 
     * @return å½“å‰ ZRangeCommand å®ä¾‹ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨
     */
    public ZRangeCommand rev() {
        this.rev = true;
        return this;
    }
    
    /**
     * è®¾ç½® WITHSCORES é€‰é¡¹ï¼šåŒæ—¶è¿”å›æˆå‘˜çš„åˆ†æ•°
     * 
     * @return å½“å‰ ZRangeCommand å®ä¾‹ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨
     */
    public ZRangeCommand withScores() {
        this.withScores = true;
        return this;
    }
    
    /**
     * è®¾ç½® LIMIT é€‰é¡¹ï¼šé™åˆ¶è¿”å›ç»“æœæ•°é‡
     * 
     * @param offset è·³è¿‡çš„å…ƒç´ æ•°é‡
     * @param count  è¿”å›çš„å…ƒç´ æ•°é‡
     * @return å½“å‰ ZRangeCommand å®ä¾‹ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨
     */
    public ZRangeCommand limit(long offset, long count) {
        this.hasLimit = true;
        this.limitOffset = offset;
        this.limitCount = count;
        return this;
    }
}
```

```java
public class ZScoreCommand extends Command {
    private static final BulkStrings CONSTANTS_ZSCORE = BulkStrings.of("ZSCORE");
    private final String key;
    private final String member;

    public ZScoreCommand(String key, String member) {
        this.key = key;
        this.member = member;
    }

    @Override
    protected List<BulkStrings> buildParams() {
        List<BulkStrings> param = new ArrayList<>(3);
        param.add(CONSTANTS_ZSCORE);
        param.add(RESP.ofString(key));
        param.add(RESP.ofString(member));
        return param;
    }
}
```

## æ€§èƒ½åŸºå‡†æµ‹è¯•ç”¨ä¾‹å¼€å‘ ğŸ“Š

ä¸ºäº†è¯„ä¼°é‡è¦å‘½ä»¤çš„æ€§èƒ½è¡¨ç°ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå…¶ç¼–å†™å¯¹åº”çš„åŸºå‡†æµ‹è¯•ç”¨ä¾‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶éæ‰€æœ‰å‘½ä»¤éƒ½éœ€è¦åŸºå‡†æµ‹è¯•ï¼Œé€šå¸¸åªå¯¹æ ¸å¿ƒæˆ–é«˜é¢‘ä½¿ç”¨çš„å‘½ä»¤è¿›è¡ŒåŸºå‡†æµ‹è¯•ä»¥è¯„ä¼°å…¶æ€§èƒ½è¡¨ç°ã€‚

### åŸºå‡†æµ‹è¯•æ¡†æ¶ä»‹ç»

Redisun ä½¿ç”¨ JUnit ç¼–å†™åŸºå‡†æµ‹è¯•ç”¨ä¾‹ï¼Œä¸»è¦æµ‹è¯•åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ“ä½œæ¨¡å¼çš„æ€§èƒ½è¡¨ç°ã€‚åŸºå‡†æµ‹è¯•ä½äº [bench](https://gitee.com/smartboot/redisun/tree/master/src/test/java/tech/smartboot/redisun/bench) åŒ…ä¸­ï¼š

```
src/test/java/tech/smartboot/redisun/bench/
â”œâ”€â”€ Bench.java              # åŸºå‡†æµ‹è¯•é…ç½®ç±»
â”œâ”€â”€ RedisunBenchmark.java   # Redisun åŸºå‡†æµ‹è¯•ç±»
â””â”€â”€ RedissonBenchmark.java  # Redisson å¯¹ç…§ç»„åŸºå‡†æµ‹è¯•ç±»
```

### æ·»åŠ æ–°å‘½ä»¤çš„åŸºå‡†æµ‹è¯•

å½“ä½ ä¸º Redisun å®ç°äº†ä¸€ä¸ªé‡è¦å‘½ä»¤åï¼Œéœ€è¦åœ¨ [RedisunBenchmark.java](https://gitee.com/smartboot/redisun/blob/master/src/test/java/tech/smartboot/redisun/bench/RedisunBenchmark.java) ä¸­æ·»åŠ ç›¸åº”çš„åŸºå‡†æµ‹è¯•æ–¹æ³•ã€‚å¦‚å‰æ‰€è¿°ï¼Œåªå¯¹æ ¸å¿ƒæˆ–é«˜é¢‘ä½¿ç”¨çš„å‘½ä»¤æ·»åŠ åŸºå‡†æµ‹è¯•ã€‚

ä»¥æˆ‘ä»¬å‰é¢å®ç°çš„ `INCR` å‘½ä»¤ä¸ºä¾‹ï¼Œå¯ä»¥æ·»åŠ å¦‚ä¸‹åŸºå‡†æµ‹è¯•æ–¹æ³•ï¼š

```java
@Test
public void incr() {
    String key = "bench_incr_key";
    // åˆå§‹åŒ–é”®å€¼
    redisun.set(key, "0");
    
    long start = System.currentTimeMillis();
    for (int i = 0; i < SET_COUNT; i++) {
        redisun.incr(key);
    }
    System.out.println("redisun incr cost " + (System.currentTimeMillis() - start) + "ms");
}

@Test
public void incrConcurrent() throws InterruptedException {
    String key = "bench_incr_concurrent_key";
    // åˆå§‹åŒ–é”®å€¼
    redisun.set(key, "0");
    
    CountDownLatch latch = new CountDownLatch(SET_COUNT);
    long start = System.currentTimeMillis();
    
    for (int i = 0; i < CONCURRENT_CLIENT_COUNT; i++) {
        Thread thread = new Thread(() -> {
            int j = 0;
            while (latch.getCount() > 0) {
                redisun.incr(key);
                j++;
                latch.countDown();
            }
        });
        thread.setDaemon(true);
        thread.start();
    }
    
    latch.await();
    System.out.println("redisun concurrent incr cost " + (System.currentTimeMillis() - start) + "ms");
}
```

ä»¥åˆ—è¡¨å‘½ä»¤ä¸ºä¾‹ï¼Œå¯ä»¥æ·»åŠ å¦‚ä¸‹åŸºå‡†æµ‹è¯•æ–¹æ³•ï¼š

```java
@Test
public void lpush() {
    String key = "bench_lpush_key";
    // å…ˆåˆ é™¤å¯èƒ½å­˜åœ¨çš„é”®
    redisun.del(key);
    
    long start = System.currentTimeMillis();
    for (int i = 0; i < SET_COUNT; i++) {
        redisun.lpush(key, "value" + i);
    }
    System.out.println("redisun lpush cost " + (System.currentTimeMillis() - start) + "ms");
}

@Test
public void lpushConcurrent() throws InterruptedException {
    String key = "bench_lpush_concurrent_key";
    // å…ˆåˆ é™¤å¯èƒ½å­˜åœ¨çš„é”®
    redisun.del(key);
    
    CountDownLatch latch = new CountDownLatch(SET_COUNT);
    long start = System.currentTimeMillis();
    
    for (int i = 0; i < CONCURRENT_CLIENT_COUNT; i++) {
        Thread thread = new Thread(() -> {
            int j = 0;
            while (latch.getCount() > 0) {
                redisun.lpush(key, "value" + j);
                j++;
                latch.countDown();
            }
        });
        thread.setDaemon(true);
        thread.start();
    }
    
    latch.await();
    System.out.println("redisun concurrent lpush cost " + (System.currentTimeMillis() - start) + "ms");
}
```

### åŸºå‡†æµ‹è¯•æœ€ä½³å®è·µ âœ…

1. **æµ‹è¯•ç¯å¢ƒä¸€è‡´æ€§**
   - ç¡®ä¿æ‰€æœ‰æµ‹è¯•éƒ½åœ¨ç›¸åŒçš„ç¡¬ä»¶å’Œç½‘ç»œç¯å¢ƒä¸‹è¿è¡Œ
   - æ¯æ¬¡æµ‹è¯•å‰æ¸…ç† Redis æ•°æ®åº“ï¼Œé¿å…å†å²æ•°æ®å½±å“æµ‹è¯•ç»“æœ

2. **æµ‹è¯•è¦†ç›–å…¨é¢**
   - åŒæ­¥æ“ä½œæ€§èƒ½æµ‹è¯•
   - å¼‚æ­¥æ“ä½œæ€§èƒ½æµ‹è¯•
   - å¹¶å‘åœºæ™¯æ€§èƒ½æµ‹è¯•

3. **ç»“æœè®°å½•ä¸å¯¹æ¯”**
   - è®°å½•æ‰§è¡Œæ—¶é—´ä½œä¸ºæ€§èƒ½æŒ‡æ ‡
   - ä¸å…¶ä»–å®¢æˆ·ç«¯ï¼ˆå¦‚ Redissonï¼‰è¿›è¡Œå¯¹æ¯”æµ‹è¯•
   - åœ¨ä¸åŒè´Ÿè½½æ¡ä»¶ä¸‹æµ‹è¯•æ€§èƒ½è¡¨ç°

## è´¡çŒ®æµç¨‹ ğŸ¤

æˆ‘ä»¬æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼è¯·æŒ‰ç…§ä»¥ä¸‹æµç¨‹å‚ä¸è´¡çŒ®ï¼š

1. **Fork é¡¹ç›®** - åœ¨ Gitee æˆ– GitHub ä¸Š Fork Redisun é¡¹ç›®
2. **åˆ›å»ºåˆ†æ”¯** - ä¸ºä½ çš„åŠŸèƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯
3. **å®ç°å‘½ä»¤** - æŒ‰ç…§æœ¬æŒ‡å—å®ç°æ–°çš„ Redis å‘½ä»¤
4. **ç¼–å†™æµ‹è¯•** - ä¸ºæ–°å‘½ä»¤ç¼–å†™å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹
5. **æ·»åŠ åŸºå‡†æµ‹è¯•** - ä¸ºé‡è¦çš„æ–°å‘½ä»¤æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆéå¿…éœ€é¡¹ï¼‰
6. **ç¼–å†™æ–‡æ¡£** - åœ¨ cmd ç›®å½•ä¸‹ä¸ºæ–°å‘½ä»¤ç¼–å†™ç›¸åº”çš„æ–‡æ¡£
7. **æäº¤ä»£ç ** - æäº¤ä½ çš„ä»£ç å¹¶æ¨é€è‡³ä½ çš„ä»“åº“
8. **å‘èµ· PR** - åˆ›å»º Pull Requestï¼Œæè¿°ä½ çš„å®ç°å†…å®¹


## æ–‡æ¡£ç¼–å†™è§„èŒƒ ğŸ“

å½“ä½ å®ç°ä¸€ä¸ªæ–°çš„ Redis å‘½ä»¤åï¼Œéœ€è¦ä¸ºå…¶ç¼–å†™ç›¸åº”çš„æ–‡æ¡£ã€‚
æ–‡æ¡£ä½äº [/pages/src/content/docs/cmd](https://gitee.com/smartboot/redisun/blob/master/pages/src/content/docs/cmd) ç›®å½•ä¸‹ï¼Œæ¯ä¸ªå‘½ä»¤éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ .mdx æ–‡ä»¶ã€‚

è¯·éµå¾ªä»¥ä¸‹æ–‡æ¡£ç¼–å†™è§„èŒƒï¼š

### æ–‡æ¡£ç»“æ„

æ¯ä¸ªå‘½ä»¤æ–‡æ¡£åº”åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

1. **æ–‡ä»¶å¤´éƒ¨** - åŒ…å«titleå’Œdescriptionç­‰å…ƒæ•°æ®
2. **å‘½ä»¤ç®€ä»‹** - ç®€è¦ä»‹ç»è¯¥å‘½ä»¤çš„ä½œç”¨
3. **RedisåŸç”Ÿå‘½ä»¤è¯­æ³•** - å±•ç¤ºRedisåŸç”Ÿçš„å‘½ä»¤è¯­æ³•
4. **å‚æ•°è¯´æ˜** - è¯¦ç»†è¯´æ˜æ¯ä¸ªå‚æ•°çš„å«ä¹‰
5. **è¯¦ç»†è¯´æ˜** - å¯¹å‘½ä»¤çš„è¯¦ç»†è§£é‡Šå’Œä½¿ç”¨åœºæ™¯
6. **Redisunä½¿ç”¨æ–¹å¼** - å±•ç¤ºå¦‚ä½•åœ¨Redisunä¸­ä½¿ç”¨è¯¥å‘½ä»¤
7. **æ³¨æ„äº‹é¡¹** - ä½¿ç”¨è¯¥å‘½ä»¤æ—¶éœ€è¦æ³¨æ„çš„äº‹é¡¹
8. **å‚è€ƒèµ„æ–™** - æŒ‡å‘Rediså®˜æ–¹æ–‡æ¡£çš„é“¾æ¥

### è¯¦ç»†è§„èŒƒ

#### 1. æ–‡ä»¶å¤´éƒ¨
```
---
title: å‘½ä»¤åç§°
description: ç®€è¦æè¿°è¯¥å‘½ä»¤çš„åŠŸèƒ½
sidebar:
  order: æ•°å­—ï¼ˆæŒ‰å­—æ¯é¡ºåºæ’åˆ—ï¼‰
---
```

#### 2. å‘½ä»¤ç®€ä»‹
åœ¨æ–‡ä»¶å¤´éƒ¨ä¹‹åï¼Œåº”ç®€è¦ä»‹ç»è¯¥å‘½ä»¤çš„ä½œç”¨ï¼Œæ— éœ€ä¸€çº§æ ‡é¢˜ã€‚

#### 3. RedisåŸç”Ÿå‘½ä»¤è¯­æ³•
ä½¿ç”¨ä¸‰çº§æ ‡é¢˜"### RedisåŸç”Ÿå‘½ä»¤è¯­æ³•"ï¼Œå¹¶ä½¿ç”¨Codeç»„ä»¶å±•ç¤ºè¯­æ³•ï¼š
```
### RedisåŸç”Ÿå‘½ä»¤è¯­æ³•

<Code code={`å‘½ä»¤è¯­æ³•`} lang="bash" />
```

#### 4. å‚æ•°è¯´æ˜
ä½¿ç”¨åŠ ç²—æ ¼å¼åˆ—å‡ºå‚æ•°è¯´æ˜ï¼Œæ— éœ€æ ‡é¢˜ï¼š
```
**å‚æ•°è¯´æ˜**

- **å‚æ•°å**: å‚æ•°è¯´æ˜
```

#### 5. è¯¦ç»†è¯´æ˜
ä½¿ç”¨ä¸‰çº§æ ‡é¢˜"### è¯¦ç»†è¯´æ˜"ï¼Œå¯ä»¥åŒ…å«å­çº§æ ‡é¢˜æ¥ç»„ç»‡å†…å®¹ã€‚

#### 6. Redisunä½¿ç”¨æ–¹å¼
ä½¿ç”¨äºŒçº§æ ‡é¢˜"## Redisunä½¿ç”¨æ–¹å¼"ï¼Œå±•ç¤ºå¦‚ä½•åœ¨Redisunä¸­ä½¿ç”¨è¯¥å‘½ä»¤ï¼Œå¹¶æä¾›ä»£ç ç¤ºä¾‹ã€‚

#### 7. æ³¨æ„äº‹é¡¹
åˆ—å‡ºä½¿ç”¨è¯¥å‘½ä»¤æ—¶éœ€è¦æ³¨æ„çš„äº‹é¡¹ã€‚

#### 8. å‚è€ƒèµ„æ–™
æä¾›æŒ‡å‘Rediså®˜æ–¹æ–‡æ¡£çš„é“¾æ¥ã€‚

## ç¤¾åŒºæ”¯æŒ ğŸ’¬

å¦‚æœä½ åœ¨å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼š

- æŸ¥çœ‹ [Redis å®˜æ–¹æ–‡æ¡£](https://redis.io/commands/) äº†è§£å‘½ä»¤è§„èŒƒ
- åœ¨é¡¹ç›® Issues ä¸­æé—®
- è”ç³»é¡¹ç›®ç»´æŠ¤è€…è·å–å¸®åŠ©

è®©æˆ‘ä»¬ä¸€èµ·æ„å»ºæ›´å¥½çš„ Redisunï¼âœ¨